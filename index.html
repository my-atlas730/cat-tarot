<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CAT it go | 貓咪主子啟示錄</title>
    <style>
        :root { --gold: #d4af37; --bg: #0d0d0d; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--gold); font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; margin: 0; overflow: hidden; height: 100vh; }
        canvas { position: absolute; top: 0; left: 0; z-index: 5; pointer-events: none; }
        .container { position: relative; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .stage { position: absolute; width: 100%; max-width: 360px; text-align: center; opacity: 0; display: none; transition: opacity 1s ease; z-index: 10; }
        .active { opacity: 1; display: block; }
        h1 { letter-spacing: 8px; color: var(--gold); font-size: 2.2rem; margin-bottom: 10px; text-shadow: 0 0 15px rgba(212,175,55,0.3); }
        textarea { width: 100%; height: 120px; background: #151515; border: 1px solid #333; color: #fff; padding: 15px; border-radius: 15px; font-size: 1rem; outline: none; resize: none; margin-top: 20px; }
        button { background: transparent; border: 1.5px solid var(--gold); color: var(--gold); padding: 15px 0; width: 100%; max-width: 250px; cursor: pointer; border-radius: 40px; font-weight: bold; font-size: 1rem; margin-top: 20px; transition: 0.4s; letter-spacing: 2px; }
        button:active { background: var(--gold); color: #000; }
        .cat-card { background: #151515; border: 1px solid var(--gold); border-radius: 20px; overflow: hidden; box-shadow: 0 10px 50px rgba(0,0,0,0.9); margin-top: 10px; animation: cardEntry 1.2s ease-out; }
        @keyframes cardEntry { 0% { transform: scale(0.95) translateY(20px); opacity: 0; } 100% { transform: scale(1) translateY(0); opacity: 1; } }
        .cat-img { width: 100%; height: auto; display: block; border-bottom: 1px solid var(--gold); background: #222; min-height: 250px; }
        .card-body { padding: 20px; }
        .title { font-size: 1.3rem; color: #fff; margin-bottom: 10px; font-weight: bold; }
        .msg { color: #aaa; line-height: 1.7; text-align: justify; font-size: 0.9rem; }
        .footer-note { font-size: 0.7rem; color: #444; margin-top: 30px; letter-spacing: 1px; }
        .loading-text { font-style: italic; color: var(--gold); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }
    </style>
</head>
<body>

<audio id="bgm" loop preload="auto" src="https://actions.google.com/sounds/v1/ambiences/morning_birds.ogg"></audio>
<canvas id="canvas"></canvas>

<div class="container">
    <div id="step0" class="stage active">
        <h1>CAT it go</h1>
        <p style="color:#666; letter-spacing: 3px;">讓煩惱隨貓砂而去</p>
        <button id="startBtn" onclick="init()">[ 進入儀式 ]</button>
        <p style="font-size: 0.6rem; color: #333; margin-top: 10px;">點擊即代表開啟主子音訊</p>
    </div>
    <div id="step1" class="stage"><p style="font-size:1.2rem; color:#fff; letter-spacing: 2px;">請放下你的執念...</p></div>
    <div id="step2" class="stage">
        <h1>鏟除煩惱</h1>
        <textarea id="userInput" placeholder="寫下任何心累的事，讓主子埋了它..."></textarea>
        <button onclick="release()">[ 隨貓砂而去 ]</button>
    </div>
    <div id="step3" class="stage">
        <div id="loadingUI" style="display:none;"><p class="loading-text">主子正在評估你的煩惱...</p></div>
        <div id="drawUI">
            <p style="font-size:1.1rem; line-height:2;">煩惱已被掩埋。<br>獲取「貓咪主子」啟示？</p>
            <button onclick="draw()">[ 請主子指點 ]</button>
        </div>
    </div>
    <div id="step4" class="stage">
        <div class="cat-card">
            <img id="resImg" class="cat-img" src="">
            <div class="card-body">
                <div id="resTitle" class="title"></div>
                <div id="resContent" class="msg"></div>
            </div>
        </div>
        <p class="footer-note">主子不回答對錯，只陪你走完這一段。</p>
        <button onclick="location.reload()" style="margin-top:10px; border-color:#333; color:#555; font-size:0.8rem; width: 60%;">[ 再次釋放 ]</button>
    </div>
</div>

<script>
    const DECK = [
        { n: "0 愚者貓", img: "cat0.jpg", m: "大膽跳吧！主子提醒你，現在正是展開新冒險的最好時機。別擔心腳下，貓有九條命，你也有無限可能。" },
        { n: "I 魔法貓", img: "cat1.jpg", m: "你擁有所需的一切資源。主子說：現在缺的只是把罐罐打開的動作，發揮你的創造力，奇蹟就在手掌心。" },
        { n: "II 女教皇貓", img: "cat2.jpg", m: "答案已在直覺中。安靜下來，像貓一樣凝視虛空，聽聽你內心那個堅定的聲音，秘密即將揭曉。" },
        { n: "III 皇后貓", img: "cat3.jpg", m: "創造與豐盛的能量正在流動。主子提醒你，要像對待幼貓一樣呵護你的計畫，耐心等待成果熟成。" },
        { n: "IV 皇帝貓", img: "cat4.jpg", m: "此時需要紀律。由你定義規則，這間房子的秩序由你掌控。建立邊界，別人才會敬畏。" },
        { n: "V 教皇貓", img: "cat5.jpg", m: "尋求共識或傳統的智慧。有時候跟著貓群的足跡走是安全的，在現有的架構中尋找最優解。" },
        { n: "VI 戀人貓", img: "cat6.jpg", m: "這不只是情感，更是價值的對齊。主子說：選擇那個讓你感到完整且能自在翻肚皮的道路。" },
        { n: "VII 戰車貓", img: "cat7.jpg", m: "意志力是唯一的推進力。鎖定獵物，不要被旁邊的紅點干擾，任何阻礙都只是墊腳石。" },
        { n: "VIII 力量貓", img: "cat8.jpg", m: "真正的強大是溫柔的掌控。用耐心感化現狀。主子說：連獅子都能被摸頭，這點事難不倒你。" },
        { n: "IX 隱者貓", img: "cat9.jpg", m: "向內求索。躲進你的心靈紙箱，孤獨不是寂寞，是為了聽清靈魂的訊息，智慧在安靜中發光。" },
        { n: "X 命運之輪貓", img: "cat10.jpg", m: "順應時勢的轉變。不需要對抗週期，只需要在浪潮中找到自己的重心。" },
        { n: "XI 正義貓", img: "cat11.jpg", m: "因果必將平衡。收起情緒，用最客觀的事實來推動公正。每份努力都會換來應有的罐罐。" },
        { n: "XII 倒吊人貓", img: "cat12.jpg", m: "換個維度思考。當下的停滯，是為了換取更長遠的洞察視角。" },
        { n: "XIII 死神貓", img: "cat13.jpg", m: "舊結構必須崩解，新能量才能注入。主子說：別去抓那根斷掉的逗貓棒，丟掉它才有新驚喜。" },
        { n: "XIV 節制貓", img: "cat14.jpg", m: "跨界調和的藝術。尋求不同觀點間的平衡。主子提醒：優雅地漫步在鋼索上，保持平衡。" },
        { n: "XV 惡魔貓", img: "cat15.jpg", m: "察覺你的執著。困住你的從來不是環境，而是對結果的渴望。放下紅點，你就自由了。" },
        { n: "XVI 高塔貓", img: "cat16.jpg", m: "崩壞是種恩賜。它清除了偽裝，讓你在真理上重建。舊的貓爬架倒了，我們可以蓋個豪華的。" },
        { n: "XVII 星星貓", img: "cat17.jpg", m: "這是一個療癒期。保持希望與純真，雖然圖片號碼印錯了，但星光依然為你閃爍。" },
        { n: "XVIII 月亮貓", img: "cat18.jpg", m: "潛意識中的恐懼正在浮現。不急著行動，等迷霧散去，真相自會大白。" },
        { n: "XIX 太陽貓", img: "cat19.jpg", m: "充滿活力的成功。一切都是透明、直接且充滿喜悅的。曬曬太陽吧，幸福就是這麼簡單。" },
        { n: "XX 審判貓", img: "cat20.jpg", m: "這是重要覺醒時刻。檢視過去，為新階段做定論。聽，那是開罐器的聲音，靈魂正在被召喚。" },
        { n: "XXI 世界貓", img: "cat21.jpg", m: "完美的閉環。你已經完成了這個階段，準備進入新高度吧！" }
    ];

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let pts = [];
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;

    function init() {
        const bgm = document.getElementById('bgm');
        // 關鍵：在使用者點擊按鈕的瞬間直接觸發播放
        bgm.play().then(() => {
            console.log("儀式音樂啟動");
        }).catch(err => {
            console.log("播放失敗，嘗試強制啟動");
            bgm.muted = true; // 先靜音播放
            bgm.play();
            bgm.muted = false; // 再取消靜音
        });

        nav('step0', 'step1');
        setTimeout(() => nav('step1', 'step2'), 2500);
    }

    function nav(f, t) {
        document.getElementById(f).classList.remove('active');
        setTimeout(() => {
            document.getElementById(f).style.display = 'none';
            document.getElementById(t).style.display = 'block';
            setTimeout(()=> document.getElementById(t).classList.add('active'), 50);
        }, 800);
    }

    function release() {
        const val = document.getElementById('userInput').value;
        if(!val.trim()) return;
        const postURL = `https://docs.google.com/forms/d/e/1FAIpQLSdN3AYEV2LGees9IfgwS3nxXwysX-BwQoBFy4_ovy0SVDQf9Q/formResponse?entry.1811273945=${encodeURIComponent(val)}&submit=Submit`;
        new Image().src = postURL; 
        createPts();
        nav('step2', 'step3');
    }

    function draw() {
        document.getElementById('drawUI').style.display = 'none';
        document.getElementById('loadingUI').style.display = 'block';
        setTimeout(() => {
            const c = DECK[Math.floor(Math.random() * DECK.length)];
            document.getElementById('resImg').src = c.img;
            document.getElementById('resTitle').innerText = c.n;
            document.getElementById('resContent').innerText = c.m;
            nav('step3', 'step4');
        }, 1500);
    }

    function createPts() {
        for (let i = 0; i < 150; i++) {
            pts.push({ x: innerWidth/2, y: innerHeight/2, sx: Math.random()*10-5, sy: Math.random()*-8-2, op: 1 });
        }
        anim();
    }

    function anim() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        pts.forEach((p,i) => {
            p.x+=p.sx; p.y+=p.sy; p.op-=0.015;
            ctx.fillStyle=`rgba(212,175,55,${p.op})`;
            ctx.fillRect(p.x, p.y, 3, 3);
            if(p.op<=0) pts.splice(i,1);
        });
        if(pts.length > 0) requestAnimationFrame(anim);
    }
</script>
</body>
</html>
