<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CAT it go | 貓咪主子啟示錄</title>
    <style>
        :root { --gold: #d4af37; --bg: #0d0d0d; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--gold); font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; margin: 0; overflow: hidden; height: 100vh; }
        canvas { position: absolute; top: 0; left: 0; z-index: 5; pointer-events: none; }
        .container { position: relative; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .stage { position: absolute; width: 100%; max-width: 360px; text-align: center; opacity: 0; display: none; transition: opacity 0.8s ease; z-index: 10; }
        .active { opacity: 1; display: block; }
        h1 { letter-spacing: 6px; color: var(--gold); font-size: 2.2rem; margin-bottom: 10px; }
        textarea { width: 100%; height: 120px; background: #1a1a1a; border: 1.5px solid #333; color: #fff; padding: 15px; border-radius: 15px; font-size: 1rem; outline: none; resize: none; margin-top: 20px; }
        button { background: transparent; border: 2px solid var(--gold); color: var(--gold); padding: 15px 0; width: 100%; max-width: 250px; cursor: pointer; border-radius: 40px; font-weight: bold; font-size: 1rem; margin-top: 20px; transition: 0.3s; }
        button:active { background: var(--gold); color: #000; }
        .cat-card { background: #151515; border: 2px solid var(--gold); border-radius: 20px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.8); margin-top: 10px; }
        .cat-img { width: 100%; height: auto; display: block; border-bottom: 1px solid var(--gold); background: #222; min-height: 250px; }
        .card-body { padding: 20px; }
        .title { font-size: 1.3rem; color: #fff; margin-bottom: 10px; letter-spacing: 2px; font-weight: bold; }
        .msg { color: #ccc; line-height: 1.6; text-align: justify; font-size: 0.9rem; }
    </style>
</head>
<body>

<audio id="bgm" loop src="https://assets.mixkit.co/music/preview/mixkit-ethereal-fairy-glade-120.mp3"></audio>
<canvas id="canvas"></canvas>

<div class="container">
    <div id="step0" class="stage active">
        <h1>CAT it go</h1>
        <p style="color:#666; letter-spacing: 2px;">讓煩惱隨貓砂而去</p>
        <button onclick="init()">[ 進入儀式 ]</button>
    </div>

    <div id="step1" class="stage">
        <p style="font-size:1.2rem; color:#fff;">請放下你的執念...</p>
    </div>

    <div id="step2" class="stage">
        <h1>鏟除煩惱</h1>
        <textarea id="userInput" placeholder="寫下任何心累的事，讓主子埋了它..."></textarea>
        <button onclick="release()">[ 隨貓砂而去 ]</button>
    </div>

    <div id="step3" class="stage">
        <p style="font-size:1.15rem; line-height:2;">煩惱已被掩埋。<br>獲取「貓咪主子」啟示？</p>
        <button onclick="draw()">[ 請主子指點 ]</button>
    </div>

    <div id="step4" class="stage">
        <div class="cat-card">
            <img id="resImg" class="cat-img" src="" alt="Cat Tarot">
            <div class="card-body">
                <div id="resTitle" class="title"></div>
                <div id="resContent" class="msg"></div>
            </div>
        </div>
        <button onclick="location.reload()" style="margin-top:20px; border-color:#444; color:#777; font-size:0.8rem; width: 60%;">[ 再次釋放 ]</button>
    </div>
</div>

<script>
    const DECK = [
        { n: "0 愚者貓", img: "cat0.jpg", m: "大膽跳吧！主子提醒你，現在正是展開新冒險的最好時機。別擔心腳下，貓有九條命，你也有無限可能。" },
        { n: "I 魔法貓", img: "cat1.jpg", m: "你擁有所需的一切資源。現在缺的只是把罐罐打開的動作，發揮你的創造力。" },
        { n: "II 女教皇貓", img: "cat2.jpg", m: "答案已在直覺中。安靜下來，像貓一樣凝視虛空，聽聽你內心那個堅定的聲音。" },
        { n: "III 皇后貓", img: "cat3.jpg", m: "創造與豐盛的能量正在流動。主子提醒你，要像對待幼貓一樣呵護你的計畫。" },
        { n: "IV 皇帝貓", img: "cat4.jpg", m: "此時需要紀律。由你定義規則，這間房子的秩序由你掌控。建立邊界，別人才會敬畏。" },
        { n: "V 教皇貓", img: "cat5.jpg", m: "尋求共識或傳統的智慧。有時候跟著貓群的足跡走是安全的，在架構中尋找最優解。" },
        { n: "VI 戀人貓", img: "cat6.jpg", m: "選擇那個讓你感到完整且能自在翻肚皮的道路。這不只是情感，更是價值的對齊。" },
        { n: "VII 戰車貓", img: "cat7.jpg", m: "意志力是唯一的推進力。鎖定獵物，不要被旁邊的紅點干擾，任何阻礙都只是墊腳石。" },
        { n: "VIII 力量貓", img: "cat8.jpg", m: "真正的強大是溫柔的掌控。用耐心感化僵化的現狀。連獅子都能被摸頭，這點事難不倒你。" },
        { n: "IX 隱者貓", img: "cat9.jpg", m: "向內求索。躲進你的心靈紙箱，孤獨不是寂寞，是為了聽清靈魂的訊息。" },
        { n: "X 命運之輪貓", img: "cat10.jpg", m: "順應時勢的轉變。不需要對抗週期，只需要在浪潮中找到自己的重心。" },
        { n: "XI 正義貓", img: "cat11.jpg", m: "因果必將平衡。收起情緒，用最客觀的事實來推動公正。每份努力都會換來應有的罐罐。" },
        { n: "XII 倒吊人貓", img: "cat12.jpg", m: "換個維度思考。就像貓倒掛在沙發緣看世界，當下的停滯，是為了換取更長遠的洞察視角。" },
        { n: "XIII 死神貓", img: "cat13.jpg", m: "舊結構必須崩解，新能量才能注入。不要去抓那根斷掉的逗貓棒，丟掉它才有新驚喜。" },
        { n: "XIV 節制貓", img: "cat14.jpg", m: "跨界調和的藝術。尋求不同觀點間的平衡。主子提醒：優雅地漫步在鋼索上，保持平衡。" },
        { n: "XV 惡魔貓", img: "cat15.jpg", m: "察覺你的執著。困住你的從來不是環境，而是對結果的渴望。放下紅點，你自然就自由了。" },
        { n: "XVI 高塔貓", img: "cat16.jpg", m: "崩壞是種恩賜。它清除了偽裝，讓你能在真理上重建。舊的貓爬架倒了，我們可以蓋個更豪華的。" },
        { n: "XVII 星星貓", img: "cat17.jpg", m: "這是一個療癒期。保持希望與純真，雖然圖片號碼印錯了，但星光依然為你閃爍。" },
        { n: "XVIII 月亮貓", img: "cat18.jpg", m: "潛意識中的恐懼正在浮現。不急著行動，等迷霧散去，真相自會大白。" },
        { n: "XIX 太陽貓", img: "cat19.jpg", m: "充滿活力的成功。一切都是透明、直接且充滿喜悅的。曬曬太陽吧，幸福很簡單。" },
        { n: "XX 審判貓", img: "cat20.jpg", m: "這是覺醒時刻。檢視過去，為新階段做定論。聽，那是開罐器的聲音，你的靈魂正在被召喚。" },
        { n: "XXI 世界貓", img: "cat21.jpg", m: "完美的閉環。你已經完成了這個階段，整個家都在你掌控中。準備進入新高度吧！" }
    ];

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let pts = [];
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;

    function init() {
        document.getElementById('bgm').play().catch(()=>{});
        nav('step0', 'step1');
        setTimeout(() => nav('step1', 'step2'), 2500);
    }

    function nav(f, t) {
        document.getElementById(f).classList.remove('active');
        setTimeout(() => {
            document.getElementById(f).style.display = 'none';
            document.getElementById(t).style.display = 'block';
            setTimeout(()=> document.getElementById(t).classList.add('active'), 50);
        }, 800);
    }

    function release() {
        const inputVal = document.getElementById('userInput').value;
        if(!inputVal.trim()) return;

        // 提交到 Google Form (自動處理 formResponse)
        const formID = "1FAIpQLSdN3AYEV2LGees9IfgwS3nxXwysX-BwQoBFy4_ovy0SVDQf9Q";
        const entryID = "1811273945";
        const postURL = `https://docs.google.com/forms/d/e/${formID}/formResponse?entry.${entryID}=${encodeURIComponent(inputVal)}&submit=Submit`;
        
        // 使用 Image 物件發送 GET 請求，避開 CORS 問題
        const nosferatu = new Image();
        nosferatu.src = postURL;

        createPts();
        nav('step2', 'step3');
    }

    function createPts() {
        for (let i = 0; i < 200; i++) {
            pts.push({ x: innerWidth/2, y: innerHeight/2, sx: Math.random()*8-4, sy: Math.random()*-6-3, op: 1 });
        }
        anim();
    }

    function anim() {
        ctx.clearRect(0,0,canvas.width,canvas.height);
        pts.forEach((p,i) => {
            p.x+=p.sx; p.y+=p.sy; p.op-=0.012;
            ctx.fillStyle=`rgba(212,175,55,${p.op})`;
            ctx.fillRect(p.x, p.y, 4, 4);
            if(p.op<=0) pts.splice(i,1);
        });
        if(pts.length > 0) requestAnimationFrame(anim);
    }

    function draw() {
        const c = DECK[Math.floor(Math.random() * DECK.length)];
        document.getElementById('resImg').src = c.img;
        document.getElementById('resTitle').innerText = c.n;
        document.getElementById('resContent').innerText = c.m;
        nav('step3', 'step4');
    }
    
    window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    });
</script>
</body>
</html>
